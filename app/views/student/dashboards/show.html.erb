<div class="grid dashboard-notices">
  <div class="grid__col-sm-6 grid__col--bleed-y">
    <div class="grid__cell">
      <h1 class="page-heading">
        Student
        <small>
          <%= link_to "Internet Safety Training",
            "http://iridescentlearning.org/internet-safety/",
            target: "_blank" %>
        </small>
      </h1>
    </div>
  </div>

  <div class="grid__col-sm-6 grid__col--bleed-y grid--align-end">
    <div class="grid__cell">
      <h1 class="page-heading">
        <%= current_student.name %>
        <small><%= render 'program_survey' %></small>
      </h1>
    </div>
  </div>
</div>

<% if not current_student.email_confirmed? %>
  <%= render 'completion_steps/confirm_changed_email',
    profile: current_student %>
<% else %>
  <div id="vue-enable-student-app">
    <%= content_tag :div,
      nil,
      id: "vue-data-registration",
      data: {
        current_account: AccountSerializer.new(current_account).serialized_json,
        current_team: TeamSerializer.new(current_team).serialized_json,
        parental_consent: ConsentSerializer.new(current_student.parental_consent).serialized_json,
        previous_attempt: AccountSerializer.new(current_account).serialized_json,
        # TODO: make original registration wizard open to currentAccount ?
        profile_icon_student: asset_path('wizard-choose-profile__student-primary.svg'),
        profile_icon_mentor: asset_path('wizard-choose-profile__mentor-secondary--female.svg'),
        profile_icon_mentor_male: asset_path('wizard-choose-profile__mentor-secondary--male.svg'),
      } %>
    <app>
      <div slot="change-email">
        <%= render 'profiles/email' %>
      </div>

      <div slot="change-password">
        <%= render 'profiles/password' %>
      </div>

      <div slot="parental-consent">
        <%= render 'student/profiles/parent' %>
      </div>

      <div slot="find-team">
        <% if current_student.is_on_team? %>
          You're on a team!
          Your team is called <%= current_team.name %>.
          You can
          <%= link_to 'manage your team',
            student_team_path(current_team) %>
        <% else %>
          <%= render "completion_steps/invitations",
            invites: current_student.team_member_invites.pending %>

          <%= render "completion_steps/join_requests",
            requests: current_student.join_requests.pending %>
        <% end %>
      </div>

      <div slot="create-team">
        <% if current_student.is_on_team? %>
          You're on a team!
          Your team is called <%= current_team.name %>.
          You can
          <%= link_to 'manage your team',
            student_team_path(current_team) %>
        <% elsif SeasonToggles.team_building_disabled? %>
          Technovation Staff has turned off forming teams for everyone right now.
        <% else %>
          <%= render "completion_steps/create_team" %>
        <% end %>
      </div>

      <div slot="find-mentor">
        <% if current_team.pending_mentor_join_request_ids.any? or
            current_team.pending_mentor_invite_ids.any? %>
          <%= render "student/dashboards/completion_steps/incoming_join_requests",
            requests: current_team.pending_mentor_join_requests %>

          <%= render "student/dashboards/completion_steps/outgoing_team_invites",
            invites: current_team.pending_mentor_invites %>
        <% elsif current_student.team.mentors.any? %>
          Your team has a mentor! You can have more than one.
          <%= link_to 'Manage your mentors',
           student_team_path(current_team, anchor: '!mentors') %>
        <% else %>
          <%= render "student/dashboards/completion_steps/find_a_mentor" %>
        <% end %>
      </div>

      <div slot="submission">
        <%= render "student/dashboards/completion_steps/team_submission" %>
      </div>

      <div slot="events">
        <% if SeasonToggles.select_regional_pitch_event? %>
          <%= render "student/dashboards/completion_steps/regional_pitch_events" %>
        <% end %>
      </div>

      <div slot="scores">
        <% if SeasonToggles.display_scores? %>
          <% if current_team.submission.complete? %>
            <%= render "student/dashboards/completion_steps/scores_and_certificates" %>
          <% elsif current_student.participated? %>
            <%= render "student/dashboards/completion_steps/participation_certificate" %>
          <% else %>
            <li class="completion-step">
              <div class="flags">
                <span class="flag">
                  Post-season
                </span>
              </div>

              <h1 class="content-heading">Thank you for your participation</h1>

              <p>
                Unfortunately, no scores are available for your team because your
                submission was incomplete. We hope you will continue working on your
                app and join us again next season!
              </p>
            </li>
          <% end %>
        <% end %>
      </div>
    </app>
  </div>
<% end %>

<%= render 'program_survey_modal' %>