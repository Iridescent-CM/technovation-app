<%= javascript_tag do %>
  function onFileUploadFinished(data) {
    $("#team_team_photo").val(data.url);

    $.ajax({
      method: "PATCH",
      url: "#{current_scope}_team_path",
      data: $("#filestack-team-photo-form").serialize(),
      success: function() {
        const teamPhoto = $("#team-photo");
        teamPhoto.attr("src", filestack_client.transform(data.handle))
      }
    });
  }
<% end %>

<%= form_with model: current_team, id: "filestack-team-photo-form" do |form| %>
  <%= form.filestack_field :team_photo,
                        "Change Image",
                        id: "team-photo-filepicker",
                        class: "filestack-picker-btn",
                        pickerOptions: {
                          fromSources: ["local_file_system","webcam", "url"],
                          uploadConfig: {
                            intelligent: true,
                          },
                          onFileUploadFinished: "onFileUploadFinished",
                          storeTo: {
                            location: "s3",
                            container: ENV.fetch("AWS_BUCKET_NAME"),
                            path: "uploads/team/team_photo/#{current_team.id}/",
                            region: "us-east-1"
                          }
                        } %>
<% end %>